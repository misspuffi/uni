(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["technician-pages-order-list"],{"51a4":function(t,e,i){"use strict";i.r(e);var a=i("6f4d"),n=i("e198");for(var s in n)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(s);var r=i("f0c5"),o=Object(r["a"])(n["default"],a["b"],a["c"],!1,null,"6f15e789",null,!1,a["a"],void 0);e["default"]=o.exports},"6f4d":function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){}));var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"order-pages"},[i("v-uni-view",{staticClass:"fix",staticStyle:{top:"-100%",left:"-100%"}},t._l(t.unix_list,(function(t,e){return i("min-countdown",{key:e,attrs:{targetTime:1e3*t.start_service_time_unix,isPlay:!0}})})),1),i("fixed",[i("tab",{attrs:{list:t.tabList,activeIndex:1*t.activeIndex,activeColor:t.primaryColor,width:100/t.tabList.length+"%",height:"100rpx"},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.handerTabChange.apply(void 0,arguments)}}}),i("v-uni-view",{staticClass:"b-1px-b"})],1),t._l(t.list.data,(function(e,a){return i("v-uni-view",{key:a,staticClass:"item-child mt-md ml-lg mr-lg pd-lg fill-base radius-16 rel",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.goDetail(a)}}},[e.is_add?i("v-uni-view",[i("v-uni-view",{staticClass:"bell-tag flex-center f-icontext c-base abs",style:{background:t.primaryColor}},[t._v("加钟服务")]),i("v-uni-view",{staticClass:"space-md"})],1):t._e(),i("v-uni-view",{staticClass:"flex-between pb-lg",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.goShop(a)}}},[i("v-uni-view",{staticClass:"f-paragraph c-title max-500 ellipsis"},[t._v("订单号："+t._s(e.order_code))]),i("v-uni-view",{staticClass:"f-caption text-bold",style:{color:2==e.pay_type?t.primaryColor:[3,4,5].includes(e.pay_type)?t.subColor:6==e.pay_type?"#11C95E":"#333"}},[t._v(t._s(t.statusType[e.pay_type]))])],1),t._l(e.order_goods,(function(a,n){return i("v-uni-view",{key:n,staticClass:"flex-center mb-lg"},[i("v-uni-view",{staticClass:"avatar lg radius-16"},[i("v-uni-view",{staticClass:"h5-image avatar lg radius-16",style:{backgroundImage:"url('"+a.goods_cover+"')"}})],1),i("v-uni-view",{staticClass:"flex-1 ml-md"},[i("v-uni-view",{staticClass:"flex-between"},[i("v-uni-view",{staticClass:"f-title c-title ellipsis",class:[{"max-300":a.refund_num>0},{"max-450":0==a.refund_num}]},[t._v(t._s(a.goods_name))]),a.refund_num>0?i("v-uni-view",{staticClass:"f-caption c-warning"},[t._v("已退x"+t._s(a.refund_num))]):t._e()],1),i("v-uni-view",{staticClass:"f-caption c-caption mt-md"},[t._v("服务时间："+t._s(e.start_time))]),i("v-uni-view",{staticClass:"flex-between"},[i("v-uni-view",{staticClass:"flex-y-baseline f-caption c-warning"},[t._v("¥"),i("v-uni-view",{staticClass:"f-title text-bold"},[t._v(t._s(a.price))])],1),i("v-uni-view",{staticClass:"c-paragraph"},[t._v("x"+t._s(a.num))])],1)],1)],1)})),i("v-uni-view",{staticClass:"flex-between pt-lg b-1px-t"},[i("v-uni-view",{staticClass:"flex-y-center f-desc c-title"},[t._v("总计："),i("v-uni-view",{staticClass:"f-paragraph c-warning text-bold"},[t._v("¥"+t._s(e.pay_price))])],1),i("v-uni-view",{staticClass:"flex-warp"},[2==e.pay_type?[i("v-uni-button",{staticClass:"clear-btn order",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.toRefuse(a)}}},[t._v("拒绝接单")]),i("v-uni-button",{staticClass:"clear-btn order",style:{color:"#fff",background:t.primaryColor,borderColor:t.primaryColor},on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.toConfirm(a,3)}}},[t._v("确认接单")])]:t._e(),3==e.pay_type||4==e.pay_type||5==e.pay_type?[i("v-uni-button",{staticClass:"clear-btn order",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.toTel(a)}}},[t._v("联系客户")]),i("v-uni-button",{staticClass:"clear-btn order",style:{color:"#fff",background:t.primaryColor,borderColor:t.primaryColor},on:{click:function(i){i.stopPropagation(),arguments[0]=i=t.$handleEvent(i),t.toConfirm(a,e.is_add?6:1*e.pay_type+1)}}},[t._v(t._s(e.is_add?"开始服务":3==e.pay_type?"已出发":4==e.pay_type?"拍照确认到达":"开始服务"))])]:t._e(),6==e.pay_type?[i("v-uni-button",{staticClass:"clear-btn order",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.toTel(a)}}},[t._v("联系客户")]),i("v-uni-button",{staticClass:"clear-btn order",style:{color:"#fff",background:t.primaryColor,borderColor:t.primaryColor},on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.toConfirm(a,7)}}},[t._v("拍照完成服务")])]:t._e(),7==e.pay_type?[e.is_add||e.label_time?t._e():i("v-uni-button",{staticClass:"clear-btn order",style:{color:"#fff",background:t.primaryColor,borderColor:t.primaryColor},on:{click:function(i){i.stopPropagation(),arguments[0]=i=t.$handleEvent(i),t.$util.goUrl({url:"/technician/pages/order/label?id="+e.id+"&uid="+e.user_id})}}},[t._v("评价客户")])]:t._e()],2)],1)],2)})),t.loading?i("load-more",{attrs:{noMore:t.list.current_page>=t.list.last_page&&t.list.data.length>0,loading:t.loading}}):t._e(),!t.loading&&t.list.data.length<=0&&1==t.list.current_page?i("abnor"):t._e(),i("v-uni-view",{staticClass:"space-footer"}),i("uni-popup",{ref:"refuse_item",attrs:{type:"center",custom:!0}},[i("v-uni-view",{staticClass:"common-popup-content fill-base pd-lg radius-34"},[i("v-uni-view",{staticClass:"title"},[t._v("拒绝接单")]),i("v-uni-view",{staticClass:"desc"},[t._v("请确认是否拒接接单")]),i("v-uni-textarea",{staticClass:"pd-lg textarea f-desc c-title mt-lg radius-20",attrs:{maxlength:"200",placeholder:"请输入拒单原因","placeholder-class":"f-desc c-caption"},model:{value:t.coach_refund_text,callback:function(e){t.coach_refund_text=e},expression:"coach_refund_text"}}),i("v-uni-view",{staticClass:"flex-center mt-md",staticStyle:{width:"540rpx"}},[i("v-uni-view",{staticClass:"flex-1"}),i("v-uni-view",[t._v(t._s(t.coach_refund_text.length>200?200:t.coach_refund_text.length)+"/200")])],1),i("v-uni-view",{staticClass:"button"},[i("v-uni-view",{staticClass:"item-child",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.$refs.refuse_item.close()}}},[t._v("取消")]),i("v-uni-view",{staticClass:"item-child c-base",style:{background:t.primaryColor,color:"#fff"},on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.confirmRefuse.apply(void 0,arguments)}}},[t._v("确定")])],1)],1)],1),i("uni-popup",{ref:"oper_item",attrs:{type:"center",custom:!0}},[i("v-uni-view",{staticClass:"common-popup-content fill-base pd-lg radius-34"},[i("v-uni-view",{staticClass:"title"},[t._v(t._s(t.popupInfo.title))]),i("v-uni-view",{staticClass:"space-md"}),4!==t.popupInfo.type?i("v-uni-view",{staticClass:"flex-warp mt-md",staticStyle:{width:"100%"}},[i("v-uni-view",[t._v("拍照打卡：")]),i("v-uni-view",{staticClass:"flex-1"},[i("upload",{attrs:{imagelist:t.popupInfo.imgs,filetype:"picture",imgtype:"imgs",text:"拍摄图片",imgsize:1,sourceType:2},on:{upload:function(e){arguments[0]=e=t.$handleEvent(e),t.imgUpload.apply(void 0,arguments)},del:function(e){arguments[0]=e=t.$handleEvent(e),t.imgUpload.apply(void 0,arguments)}}})],1)],1):t._e(),i("v-uni-view",{staticClass:"flex-warp mt-md",staticStyle:{width:"100%"}},[i("v-uni-view",[t._v("当前地点：")]),i("v-uni-view",{staticClass:"flex-1",class:[{"c-title":t.popupInfo.location.address},{"c-caption":!t.popupInfo.location.address}],on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.toGetLocation.apply(void 0,arguments)}}},[t._v(t._s(t.popupInfo.location.address||"点击获取定位"))])],1),i("v-uni-view",{staticClass:"button"},[i("v-uni-view",{staticClass:"item-child",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.$refs.oper_item.close()}}},[t._v("取消")]),i("v-uni-view",{staticClass:"item-child c-base",style:{background:t.primaryColor,color:"#fff"},on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.confirmOper.apply(void 0,arguments)}}},[t._v("确定")])],1)],1)],1)],2)},n=[]},"85aa":function(t,e,i){"use strict";i("7a82");var a=i("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("99af"),i("ac1f"),i("5319"),i("caad"),i("a434"),i("c740"),i("14d9");var n=a(i("c7eb")),s=a(i("1da1")),r=a(i("5530")),o=i("26cb"),l={components:{},data:function(){return{options:{},activeIndex:0,tabList:[{title:"待接单",id:2,number:0},{title:"待服务",id:5,number:0},{title:"服务中",id:6,number:0},{title:"已完成",id:7,number:0}],statusType:{2:"待接单",3:"已接单",4:"已出发",5:"已到达",6:"服务中",7:"已完成"},param:{page:1,pay_type:0},list:{data:[]},loading:!0,index:-1,coach_refund_text:"",lockTap:!1,popupInfo:{title:"",index:"",type:"",param:{},imgs:[],location:{lat:0,lng:0,address:""}},unix_list:[]}},computed:(0,o.mapState)({primaryColor:function(t){return t.config.configInfo.primaryColor},subColor:function(t){return t.config.configInfo.subColor},configInfo:function(t){return t.config.configInfo},userInfo:function(t){return t.user.userInfo}}),onLoad:function(t){this.options=t;var e=t.tab,i=void 0===e?0:e;this.activeIndex=i,this.initIndex()},onPullDownRefresh:function(){uni.showNavigationBarLoading(),this.initRefresh(),uni.stopPullDownRefresh()},onReachBottom:function(){this.list.current_page>=this.list.last_page||this.loading||(this.param.page=this.param.page+1,this.loading=!0,this.getList())},methods:(0,r.default)((0,r.default)((0,r.default)({},(0,o.mapActions)(["getConfigInfo"])),(0,o.mapMutations)([""])),{},{initIndex:function(){var t=arguments,e=this;return(0,s.default)((0,n.default)().mark((function i(){var a;return(0,n.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(a=t.length>0&&void 0!==t[0]&&t[0],a||!e.$jweixin.isWechat()){i.next=5;break}return i.next=4,e.$jweixin.initJssdk();case 4:e.$jweixin.wxReady((function(){e.$jweixin.hideOptionMenu()}));case 5:if(e.configInfo.id&&!a){i.next=8;break}return i.next=8,e.getConfigInfo();case 8:return i.next=10,e.getList();case 10:e.$util.setNavigationBarColor({bg:e.primaryColor});case 11:case"end":return i.stop()}}),i)})))()},initRefresh:function(){this.param.page=1,this.initIndex(!0)},getList:function(){var t=arguments,e=this;return(0,s.default)((0,n.default)().mark((function i(){var a,s,r,o,l,c;return(0,n.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return a=t.length>0&&void 0!==t[0]&&t[0],s=e.list,r=e.param,o=e.tabList,l=e.activeIndex,r.pay_type=o[l].id,i.next=5,e.$api.technician.orderList(r);case 5:c=i.sent,a||(1==e.param.page||(c.data=s.data.concat(c.data)),e.list=c),e.tabList[0].number=c.agent_order_count,e.tabList[1].number=c.wait_order_count,e.tabList[2].number=c.service_order_count,e.loading=!1,e.$util.hideAll();case 12:case"end":return i.stop()}}),i)})))()},handerTabChange:function(t){this.activeIndex=t,this.$util.showLoading(),this.param.page=1,this.getList()},toRefuse:function(t){var e=this;return(0,s.default)((0,n.default)().mark((function i(){return(0,n.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:e.index=t,e.coach_refund_text="",e.$refs.refuse_item.open();case 3:case"end":return i.stop()}}),i)})))()},confirmRefuse:function(){var t=this;return(0,s.default)((0,n.default)().mark((function e(){var i,a;return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=t.coach_refund_text,i=i.length>0?i.replace(/(^\s*)|(\s*$)/g,""):"",0!=i.length){e.next=5;break}return t.$util.showToast({title:"请输入拒单原因"}),e.abrupt("return");case 5:t.coach_refund_text=t.coach_refund_text.substring(0,200),a=t.index,t.toConfirm(a,-1);case 8:case"end":return e.stop()}}),e)})))()},toGetLocation:function(){var t=this;return(0,s.default)((0,n.default)().mark((function e(){var i,a,s,r,o,l,c,u,d,p,f,v,_,g,h,m,x,w;return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=t.popupInfo,a=i.lat,s=void 0===a?0:a,r=i.lng,o=void 0===r?0:r,l=i.address,c=void 0===l?"":l,!(s&&o&&c)){e.next=3;break}return e.abrupt("return");case 3:if(!t.$jweixin.isWechat()){e.next=25;break}return t.$util.showLoading(),e.next=7,t.$jweixin.wxReady2();case 7:return e.next=9,t.$jweixin.getWxLocation();case 9:if(u=e.sent,d=u.latitude,p=void 0===d?0:d,f=u.longitude,v=void 0===f?0:f,p){e.next=18;break}return t.$util.hideAll(),t.$util.showToast({title:"请授权定位当前地址"}),e.abrupt("return");case 18:if(!p||!v){e.next=25;break}return _="".concat(p,",").concat(v),e.next=22,t.$api.base.getMapInfo({location:_});case 22:g=e.sent,h=JSON.parse(g),m=h.status,x=h.result,0==m&&(t.$util.hideAll(),w=x.address,t.popupInfo.location={lat:p,lng:v,address:w});case 25:case"end":return e.stop()}}),e)})))()},imgUpload:function(t){var e=t.imagelist,i=t.imgtype;this.popupInfo[i]=e},confirmOper:function(){var t=this.$util.deepCopy(this.popupInfo),e=t.index,i=t.type,a=t.param,n=t.imgs,s=t.location,r=s.lat,o=void 0===r?0:r,l=s.lng,c=void 0===l?0:l,u=s.address,d=void 0===u?"":u;if([5,7].includes(i)&&0===n.length)this.$util.showToast({title:"请先拍照"});else if(o||c||d){if([5,7].includes(i)){var p=n[0].path;s.path=p}this.toConfirmUpdate(e,i,a,s)}else this.$util.showToast({title:"请先获取当前定位地址"})},toConfirm:function(t,e){var i=this;return(0,s.default)((0,n.default)().mark((function a(){var s,r,o,l;return(0,n.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(s=i.list.data[t].id,r={order_id:s,type:e},-1==e&&(r.coach_refund_text=i.coach_refund_text),![4,5,7].includes(e)){a.next=12;break}return o={4:"确认出发",5:"确认到达",7:"确认完成"},l=o[e],i.popupInfo=Object.assign({},i.popupInfo,{title:l,index:t,type:e,param:r,imgs:[],location:{lat:0,lng:0,address:""}}),a.next=9,i.toGetLocation();case 9:i.$refs.oper_item.open(),a.next=13;break;case 12:i.toConfirmUpdate(t,e,r);case 13:case"end":return a.stop()}}),a)})))()},toConfirmUpdate:function(t,e,i){var a=arguments,r=this;return(0,s.default)((0,n.default)().mark((function s(){var o,l,c,u,d,p,f,v,_,g,h,m,x,w,b,y;return(0,n.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=a.length>3&&void 0!==a[3]?a[3]:{},[4,5,7].includes(e)&&(l=o.lat,c=o.lng,u=o.address,d=o.path,4===e&&(i.serout_lat=l,i.serout_lng=c,i.serout_address=u),5==e&&(i.arrive_img=d,i.arr_lat=l,i.arr_lng=c,i.arr_address=u),7==e&&(i.end_img=d,i.end_lat=l,i.end_lng=c,i.end_address=u)),p={"-1":"已拒绝接单",3:"接单成功",4:"已成功出发",5:"已成功到达",6:"已开始服务",7:"服务已完成"},!r.lockTap){n.next=5;break}return n.abrupt("return");case 5:return r.lockTap=!0,r.$util.showLoading(),f=r.list.data[t],v=f.is_add,_=void 0===v?0:v,g=f.add_pid,h=void 0===g?0:g,n.prev=8,n.next=11,r.$api.technician.updateOrder(i);case 11:if(-1==e&&r.$refs.refuse_item.close(),[4,5,7].includes(e)&&r.$refs.oper_item.close(),r.$util.showToast({title:p[e]}),4==e||5==e?r.list.data[t].pay_type=e:(r.list.data.splice(t,1),7==e&&_&&h&&(m=r.unix_list.findIndex((function(t){return t.id==h})),-1!=m&&r.unix_list.splice(m,1),setTimeout((function(){var t=r.list.data.findIndex((function(t){return t.id=h}));-1!=t&&r.list.data.splice(t,1)}),500))),r.lockTap=!1,r.$util.hideAll(),6!=e){n.next=25;break}return n.next=20,r.$api.order.orderInfo({id:i.order_id});case 20:x=n.sent,w=x.time_long,b=x.start_service_time,y=r.$util.DateToUnix(b)+60*w,r.unix_list.push({id:i.order_id,time_long:w,start_service_time:b,start_service_time_unix:y});case 25:return n.next=27,r.getList(!0);case 27:n.next=33;break;case 29:return n.prev=29,n.t0=n["catch"](8),setTimeout((function(){r.lockTap=!1,r.$util.hideAll()}),2e3),n.abrupt("return");case 33:case"end":return n.stop()}}),s,null,[[8,29]])})))()},toTel:function(t){var e=this;return(0,s.default)((0,n.default)().mark((function i(){var a,s;return(0,n.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return a=e.list.data[t].id,i.next=3,e.$api.base.getVirtualPhone({order_id:a});case 3:s=i.sent,e.$util.goUrl({url:s,openType:"call"});case 5:case"end":return i.stop()}}),i)})))()},goDetail:function(t){var e=this.list.data[t].id,i="/technician/pages/order/detail?id=".concat(e);this.$util.goUrl({url:i})}})};e.default=l},e198:function(t,e,i){"use strict";i.r(e);var a=i("85aa"),n=i.n(a);for(var s in a)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(s);e["default"]=n.a}}]);