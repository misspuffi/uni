(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["technician-pages-time-manage"],{"180d":function(e,t,i){"use strict";i("7a82");var a=i("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i("4e82"),i("d3b7"),i("159b"),i("99af");var n=a(i("c7eb")),o=a(i("1da1")),s=a(i("5530")),c=i("26cb"),r=a(i("a849")),u=a(i("6761")),l=a(i("436d")),d=i("6aa4"),m=uni.requireNativePlugin("DC-WBFaceServiceV2"),h={components:{wPicker:r.default,tab:u.default},data:function(){return{countDown:"",toDay:"",toDayTime:"",showKey:"",progress:0,showTime:!1,form:{id:0,is_work:0,start_time:"",end_time:"",coach_status:0,time_unit:""},is_next_day:!1,dayList:[],face_img:"",face_img_base64:"",work_img:[],id_code:"",signTickets:"",coach_name:"",dayCurrent:0,status:!1,appid:"IDAdoIMa",secret:"eRdoxMnzou4SNlJ7yLVkRKtqAblzbBaWGOSyspntasIKU5BYNelxPCKfPY587cj3",userId:(0,d.randomString)(8),orderNo:(0,d.randomString)(9),nonce:(0,d.randomString)(32),version:"1.0.0",licence:"RWdRqRVm3ngdlc0+KR+1yYNEX5h4Op5MGLHxWUqRb5UVUIr0D6RabSkaqFIFHA8s2fiD9xkHy50kMJG+KByXuMpQkYoCgIRyzsFytMBB05S2lG+dOCnc95zk7nBVdwGsWs5ibjNod/TO/xRFyKXyGAjeBTgIFXdFZnhQ1G1T9c9T+bTJGSu5R6DHqRvah+weVQiUfu/GpCZh6EXFbn5JwUEm+PDpF6KN9YZngFjIo2nN1MgQZqWunDSHgqhFV2TM/gfjmgXLn4ZG5pDwTxVQsNjZm3aGFuF9TXbEHQjUP1TQevbzXG2Hg4sS5IJFwpPB0xKrw6tVphGgZsZOhDO0cQ=="}},computed:(0,c.mapState)({primaryColor:function(e){return e.config.configInfo.primaryColor},subColor:function(e){return e.config.configInfo.subColor},userInfo:function(e){return e.user.userInfo}}),onLoad:function(){this.initIndex()},methods:(0,s.default)((0,s.default)({},(0,c.mapMutations)(["updateTechnicianItem"])),{},{imgUpload:function(e){var t=e.imagelist;this.work_img=t;var i={work_img:t[0]["path"],type:2};console.log(i);var a=this.$api.technician.setFaceCheck(i);console.log(a),this.$util.hideAll(),this.$util.showToast({title:"更新成功"}),this.initIndex()},getAccessToken:function(){var e=this;uni.request({method:"GET",url:"https://miniprogram-kyc.tencentcloudapi.com/api/oauth2/access_token",data:{app_id:this.appid,secret:this.secret,grant_type:"client_credential",version:this.version},success:function(t){if(t.code)uni.removeStorage({key:"signTickets"}),uni.showToast({icon:"none",title:t.msg});else{var i=t.data.access_token;uni.setStorage({key:"access_token",value:i,expires:72e5}),e.getSIGNticket(i)}}})},getSIGNticket:function(e){var t=this;uni.request({method:"GET",url:"https://miniprogram-kyc.tencentcloudapi.com/api/oauth2/api_ticket",data:{app_id:this.appid,access_token:e,type:"SIGN",version:this.version},success:function(e){if(e.code)uni.showToast({icon:"none",title:e.msg});else{var i=e.data.tickets[0].value;t.signTickets=i,uni.setStorage({key:"signTickets",value:i,expires:12e5}),t.getFaceIdSign(i)}}})},getFaceIdSign:function(e){var t=[this.appid,this.nonce,this.userId,e,this.version];t.sort();for(var i="",a=0,n=t;a<n.length;a++){var o=n[a];i+="".concat(o)}var s=(0,l.default)(i).toUpperCase();this.getFaceId(s)},getFaceIdSign1:function(e){var t=[this.appid,this.nonce,this.orderNo,e,this.version];console.log(t),t.sort();for(var i="",a=0,n=t;a<n.length;a++){var o=n[a];i+="".concat(o)}return(0,l.default)(i).toUpperCase()},getFaceId:function(e){var t=this,i=this.face_img_base64;uni.request({method:"POST",url:"https://miniprogram-kyc.tencentcloudapi.com/api/server/getAdvFaceId?orderNo="+this.orderNo,data:{webankAppId:this.appid,orderNo:this.orderNo,userId:this.userId,version:this.version,sign:e,nonce:this.nonce,sourcePhotoStr:i,sourcePhotoType:"2"},success:function(i){if(0==i.data.code){var a=i.data.result,n=a.faceId;t.startWbFaceVerifyService(e,n)}else uni.showToast({icon:"none",title:i.data.msg})}})},startWbFaceVerifyService:function(e,t){var i=this,a=this;try{m.startAdvanceWbFaceVerifyService({apiVersion:"1.0.0",appId:this.appid,nonce:this.nonce,userId:this.userId,sign:e,orderNo:this.orderNo,licence:this.licence,faceId:t,compareType:"1",sdkConfig:{showSuccessPage:!1,showFailurePage:!1,recordVideo:!1,checkVideo:!1,playVoice:!1,theme:"1",customerTipsLoc:"0",customerTipsInLive:"",customerTipsInUpload:"",customerLongTip:"",isEnableLog:!0,windowLevel:"1",manualCookie:!0,useWindowScene:!1,useAdvanceCompare:!0}},(function(e){console.log(e);var t=e.scene;if(uni.hideLoading(),"wb_face_callback_login_failure"==t)return uni.removeStorage({key:"signTickets"}),void uni.showModal({title:"刷脸失败",content:"刷脸失败，请重试?",success:function(e){e.confirm?a.check():e.cancel&&console.log("用户点击取消")}});if("wb_face_callback_verify_result"==t){var n=e.res,o=n.success;if(o){uni.showToast({icon:"none",title:"人脸核验成功:活体可能性："+n.liveRate+"%; 人脸相似度：="+n.similarity+"%"}),a.orderNo=n.orderNo;var s=a.getFaceIdSign1(a.signTickets),c={appId:a.appid,sign:s,version:a.version,nonce:a.nonce,orderNo:a.orderNo,getFile:2};uni.request({method:"POST",url:"https://miniprogram-kyc.tencentcloudapi.com/api/v2/base/queryfacerecord?orderNo="+a.orderNo,data:c,success:function(e){if(console.log(e),0==e.data.code){i.submit(t);var t={face_img:e.data.result.photo,similarity:n.similarity,type:1};i.$api.technician.setFaceCheck(t),i.$util.hideAll(),i.$util.showToast({title:"更新成功"}),i.updateTechnicianItem({key:"haveOperItem",val:!0}),setTimeout((function(){i.$util.back(),i.$util.goUrl({url:1,openType:"navigateBack"})}),2e3)}else uni.showToast({icon:"none",title:e.msg})}})}else{var r=n.error,u=r.domain;if("WBFaceErrorDomainCompareServer"==u)return void uni.showModal({title:"对比失败",content:"与工作照对比失败，请重试",success:function(e){e.confirm?a.check():e.cancel&&console.log("用户点击取消")}});uni.showToast({icon:"none",title:"刷脸失败，请重试"})}}}))}catch(n){console.log("【uni log】startWbFaceVerifyService error",n),uni.showToast({icon:"none",title:n.message})}},check:function(){var e=this;uni.showLoading({mask:!0,title:"即将进入人脸核验..."}),setTimeout((function(){uni.hideLoading(),uni.showLoading({mask:!0,title:"等待中..."});var t=uni.getStorage("signTickets");t&""!=t?e.getFaceIdSign(t):e.getAccessToken()}),3500)},initIndex:function(){var e=this;return(0,o.default)((0,n.default)().mark((function t(){var i,a,o,s,c;return(0,n.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.$jweixin.isWechat()){t.next=4;break}return t.next=3,e.$jweixin.initJssdk();case 3:e.$jweixin.wxReady((function(){e.$jweixin.hideOptionMenu()}));case 4:return i=new Date(Math.ceil((new Date).getTime())),e.toDay=e.$util.formatTime(i,"YY-M-D"),e.toDayTime=e.$util.formatTime(i,"h:m"),t.next=9,e.$api.technician.timeConfig();case 9:for(o in a=t.sent,e.form)e.form[o]=a[o];a.day_list.forEach((function(e,t){e.title=0==t?"今天":e.dat_text,e.sub=[]})),e.form.time_unit=a.time_unit,e.dayList=a.day_list,e.$util.setNavigationBarColor({bg:e.primaryColor}),e.face_img=a.face_img,e.face_img_base64=a.face_img_base64,e.userId=a.user_id,e.progress=a.similarity,e.work_img=a.work_img,e.work_img=[{path:a.work_img}],e.id_code=a.id_code,e.coach_name=a.coach_name,a.is_out?(s=new Date(a.check_time).getTime(),c=setInterval((function(){var t=(new Date).getTime(),i=s-t,a=Math.floor(i/864e5),n=Math.floor(i%864e5/36e5),o=Math.floor(i%36e5/6e4),r=Math.floor(i%6e4/1e3);e.countDown="核验倒计时：".concat(a,"天 ").concat(n,"时 ").concat(o,"分 ").concat(r,"秒"),i<0&&(clearInterval(c),e.countDown="核验已过期")}),1e3)):e.countDown="核验已过期",e.toCount();case 25:case"end":return t.stop()}}),t)})))()},toChangeItem:function(){3!=this.form.coach_status&&(this.form.is_work=1==this.form.is_work?0:1)},toShowTime:function(e){3!=this.form.coach_status&&(this.showKey=e,this.showTime=!0)},onConfirm:function(e){this.form[this.showKey]=e.result,this.toCount()},toCount:function(){var e=this.toDay,t=void 0===e?"":e,i=this.form,a=i.start_time,n=void 0===a?"":a,o=i.end_time,s=void 0===o?"":o;if(t&&n&&s){var c="".concat(t," ").concat(n),r="".concat(t," ").concat(s);this.is_next_day=this.$util.DateToUnix(c)>=this.$util.DateToUnix(r),this.dayList.forEach((function(e){e.sub=[]})),this.getTimeCall()}},getTimeCall:function(){var e=this;return(0,o.default)((0,n.default)().mark((function t(){var i,a,o,s,c,r,u,l;return(0,n.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$util.showLoading(),i=e.form,a=i.start_time,o=void 0===a?"":a,s=i.end_time,c=void 0===s?"":s,r=e.dayCurrent,u=e.dayList,t.next=5,e.$api.technician.getTime({start_time:o,end_time:c,dat_str:u[r].dat_str});case 5:l=t.sent,e.dayList[r].sub=l,e.$util.hideAll();case 8:case"end":return t.stop()}}),t)})))()},submit:function(){var e=this;return(0,o.default)((0,n.default)().mark((function t(){var i;return(0,n.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=e.$util.deepCopy(e.form),i.start_time&&i.end_time){t.next=4;break}return e.$util.showToast({title:i.start_time?"请选择结束时间":"请选择开始时间"}),t.abrupt("return");case 4:return delete i.coach_status,i.time_text=e.dayList,e.$util.showLoading(),t.next=9,e.$api.technician.setTimeConfig(i);case 9:e.$util.hideAll(),e.$util.showToast({title:"保存成功"}),e.updateTechnicianItem({key:"haveOperItem",val:!0}),setTimeout((function(){e.$util.back(),e.$util.goUrl({url:1,openType:"navigateBack"})}),1e3);case 13:case"end":return t.stop()}}),t)})))()},setDate:function(e){this.dayCurrent=e},getDateTime:function(e){if(3!=this.form.coach_status){var t=this.dayCurrent;this.dayList[t].sub&&1==this.dayList[t].sub[e].is_order||(this.dayList[t].sub[e].is_click=0==this.dayList[t].sub[e].is_click?1:0,this.dayList[t].sub[e].status=0==this.dayList[t].sub[e].status?1:0)}},handerTabChange:function(e){3!=this.form.coach_status&&(this.dayCurrent=e,this.dayList[e].sub&&this.dayList[e].sub.length||this.getTimeCall())},isTimes:function(e){var t=new Date;return t.getTime()/1e3>e}})};t.default=h},"1a24":function(e,t,i){var a=i("743b");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var n=i("4f06").default;n("6f521a6d",a,!0,{sourceMap:!1,shadowMode:!1})},2822:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return a}));var a={wPicker:i("a849").default},n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",{staticClass:"technician-time-manage"},[i("v-uni-view",{staticClass:"fill-base pd-lg flex-between"},[i("v-uni-view",{staticClass:"flex-1 flex-y-baseline f-title c-title"},[e._v("是否接单"),i("v-uni-view",{staticClass:"f-paragraph ml-sm",style:{color:1==e.form.is_work?e.primaryColor:"#999"}},[e._v(e._s(1==e.form.is_work?"接单":"休息"))])],1),i("v-uni-view",{on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.toChangeItem.apply(void 0,arguments)}}},[i("i",{staticClass:"iconfont icon-switch c-caption ml-sm",class:[{"icon-switch-on":1==e.form.is_work}],style:{color:1==e.form.is_work?e.primaryColor:""}})])],1),i("v-uni-view",{staticClass:"flex-center fill-base f-paragraph c-desc pt-lg pb-lg b-1px-b"},[i("v-uni-view",{staticClass:"countDown"},[e._v(e._s(e.countDown))])],1),i("v-uni-view",{staticClass:"flex-center fill-base f-paragraph c-desc pt-lg pb-lg b-1px-b"},[i("v-uni-view",{staticClass:"item-time flex-center flex-column"},[i("v-uni-view",[e._v("工作照")]),i("upload",{staticClass:"logo-img radius",attrs:{imagelist:e.work_img,"lazy-load":!0,text:"上传图片",imgsize:1},on:{upload:function(t){arguments[0]=t=e.$handleEvent(t),e.imgUpload.apply(void 0,arguments)}}})],1),i("v-uni-view",{staticClass:"item-time flex-center flex-column  b-1px-l"},[i("v-uni-view",[e._v("刷脸照")]),i("v-uni-image",{staticClass:"logo-img radius",attrs:{mode:"aspectFill","lazy-load":!0,src:e.face_img},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.check()}}}),i("v-uni-view",[e._v("点击照片进行核验")])],1)],1),i("v-uni-view",{staticClass:"container"},[i("v-uni-view",{staticClass:"strip"},[i("v-uni-view",{staticClass:"progress"},[e._v("相似度："+e._s(e.progress)+"%")]),i("v-uni-view",{staticClass:"blue",style:"width:"+e.progress+"%"})],1)],1),i("v-uni-view",{staticClass:"fill-base mt-md b-1px-b"},[i("v-uni-view",{staticClass:"f-title c-title pd-lg"},[e._v("选择接单时间")])],1),i("v-uni-view",{staticClass:"flex-center fill-base f-paragraph c-desc pt-lg pb-lg b-1px-b"},[i("v-uni-view",{staticClass:"item-time flex-center flex-column",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.toShowTime("start_time")}}},[i("v-uni-view",[e._v("开始时间")]),i("v-uni-view",{staticClass:"mt-sm",style:{color:e.form.start_time?e.primaryColor:"#999"}},[e._v(e._s(e.form.start_time||"选择时间"))])],1),i("v-uni-view",{staticClass:"item-time flex-center flex-column  b-1px-l",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.toShowTime("end_time")}}},[i("v-uni-view",[e._v("结束时间")]),i("v-uni-view",{staticClass:"mt-sm",style:{color:e.form.end_time?e.primaryColor:"#999"}},[e._v(e._s(e.is_next_day?"次日":"")+e._s(e.form.end_time||"选择时间"))])],1)],1),i("v-uni-view",{staticClass:"space-max-footer"}),i("w-picker",{ref:"time",attrs:{visible:e.showTime,mode:"time",value:e.toDayTime,current:!1,second:!1,themeColor:e.primaryColor},on:{"update:visible":function(t){arguments[0]=t=e.$handleEvent(t),e.showTime=t},confirm:function(t){arguments[0]=t=e.$handleEvent(t),e.onConfirm.apply(void 0,arguments)}}}),3!=e.form.coach_status?i("fix-bottom-button",{attrs:{text:[{text:"保存",type:"confirm",isAuth:!0}],bgColor:"#fff"},on:{confirm:function(t){arguments[0]=t=e.$handleEvent(t),e.submit.apply(void 0,arguments)}}}):e._e()],1)},o=[]},"37b4":function(e,t,i){"use strict";var a=i("1a24"),n=i.n(a);n.a},"4d38":function(e,t,i){"use strict";i.r(t);var a=i("2822"),n=i("f2f5");for(var o in n)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(o);i("37b4");var s=i("f0c5"),c=Object(s["a"])(n["default"],a["b"],a["c"],!1,null,"aa7545a0",null,!1,a["a"],void 0);t["default"]=c.exports},"743b":function(e,t,i){var a=i("24fb");t=a(!1),t.push([e.i,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.technician-time-manage .iconfont[data-v-aa7545a0]{font-size:%?80?%;line-height:%?34?%}.technician-time-manage .item-time[data-v-aa7545a0]{width:50%}.technician-time-manage .date-title[data-v-aa7545a0]{padding-bottom:%?60?%}.technician-time-manage .date-title uni-text[data-v-aa7545a0]{border-bottom:3px solid transparent}.technician-time-manage .date-list[data-v-aa7545a0]{word-break:break-all;flex-flow:wrap}.technician-time-manage .date-list .date-item[data-v-aa7545a0]{width:%?163?%;height:%?110?%;border:1px solid #e5e5e5}.technician-time-manage .date-list .date-item-prohibit[data-v-aa7545a0]{background:#f6f7f7}.technician-time-manage .date-list .c-5A677E[data-v-aa7545a0]{color:#5a677e}.technician-time-manage .logo-img[data-v-aa7545a0]{width:%?250?%;height:%?250?%}.technician-time-manage .countDown[data-v-aa7545a0]{font-size:%?40?%;color:#fd0101}.technician-time-manage .container[data-v-aa7545a0]{padding:%?20?% %?20?%}.technician-time-manage .strip[data-v-aa7545a0]{position:relative;width:100%;height:%?30?%;color:#505050;background-color:#f5f5f5;font-size:%?28?%;line-height:150%;text-align:center;margin-bottom:%?12?%;border-radius:%?20?%}.technician-time-manage .progress[data-v-aa7545a0]{font-size:%?35?%;color:#008ef6}.technician-time-manage .yellow[data-v-aa7545a0]{height:%?24?%;color:#505050;background-color:#fa8c16;border-radius:%?20?%;font-size:%?28?%;line-height:150%;text-align:center}.technician-time-manage .red[data-v-aa7545a0]{height:%?24?%;color:#505050;background-color:#e02020;border-radius:%?20?%;font-size:%?28?%;line-height:150%;text-align:center}.technician-time-manage .blue[data-v-aa7545a0]{height:%?24?%;color:#505050;background-color:#008ef6;border-radius:%?20?%;font-size:%?28?%;line-height:150%;text-align:center}',""]),e.exports=t},f2f5:function(e,t,i){"use strict";i.r(t);var a=i("180d"),n=i.n(a);for(var o in a)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return a[e]}))}(o);t["default"]=n.a}}]);